# WebCMS API Specification

**Base URL:** `https://webspark.markhazleton.com/api/WebCMS/WebCMSApi`

**Version:** 1.0

**Authentication:** Bearer Token Required

**Content Type:** `application/json`

---

## Table of Contents

1. [Authentication](#authentication)
2. [Response Format](#response-format)
3. [Error Handling](#error-handling)
4. [Website Management](#website-management)
5. [Menu Management](#menu-management)
6. [Utility Endpoints](#utility-endpoints)
7. [Models](#models)
8. [Examples](#examples)

---

## Authentication

All API endpoints require authentication via Bearer token in the Authorization header:

```
Authorization: Bearer {your-token}
```

**Unauthorized Response (401):**
```json
{
  "success": false,
  "error": "Unauthorized",
  "message": "Authentication required"
}
```

---

## Response Format

### Success Response
```json
{
  "success": true,
  "data": { /* response data */ },
  "message": "Operation completed successfully"
}
```

### Error Response
```json
{
  "success": false,
  "error": "Error Type",
  "message": "Human readable error message",
  "validationErrors": {
    "fieldName": ["Error message 1", "Error message 2"]
  }
}
```

### Paginated Response
```json
{
  "success": true,
  "data": {
    "items": [/* array of items */],
    "totalCount": 100,
    "page": 1,
    "pageSize": 20,
    "totalPages": 5
  },
  "message": "Retrieved 20 items"
}
```

---

## Website Management

### Get All Websites
**GET** `/websites`

**Query Parameters:**
- `page` (int, optional): Page number (default: 1)
- `pageSize` (int, optional): Items per page (max: 100, default: 20)
- `search` (string, optional): Search term for name or description
- `template` (string, optional): Filter by template type
- `isRecipeSite` (bool, optional): Filter by recipe site flag

**Response:** Paginated list of websites

**Example Request:**
```
GET /websites?page=1&pageSize=10&search=blog&template=Modern
```

**Example Response:**
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": 1,
        "name": "My Blog Site",
        "description": "A modern blog website",
        "siteTemplate": "Modern",
        "siteStyle": "Light",
        "websiteUrl": "https://example.com",
        "useBreadCrumbURL": true,
        "isRecipeSite": false,
        "modifiedDT": "2023-12-01T10:30:00Z"
      }
    ],
    "totalCount": 1,
    "page": 1,
    "pageSize": 10,
    "totalPages": 1
  },
  "message": "Retrieved 1 websites"
}
```

### Get Website by ID
**GET** `/websites/{id}`

**Path Parameters:**
- `id` (int, required): Website ID

**Response:** Single website object

### Create Website
**POST** `/websites`

**Request Body:**
```json
{
  "name": "Website Name",
  "description": "Website description",
  "siteTemplate": "Modern",
  "siteStyle": "Light",
  "message": "Welcome to our site",
  "siteName": "Display Name",
  "websiteUrl": "https://example.com",
  "websiteTitle": "Page Title",
  "useBreadCrumbURL": true,
  "isRecipeSite": false
}
```

**Response:** Created website object with HTTP 201

### Update Website
**PUT** `/websites/{id}`

**Path Parameters:**
- `id` (int, required): Website ID

**Request Body:** (All fields optional)
```json
{
  "name": "Updated Website Name",
  "description": "Updated description",
  "siteTemplate": "Classic",
  "useBreadCrumbURL": false
}
```

**Response:** Updated website object

### Delete Website
**DELETE** `/websites/{id}`

**Path Parameters:**
- `id` (int, required): Website ID

**Response:**
```json
{
  "success": true,
  "data": { "deletedId": 1 },
  "message": "Website deleted successfully"
}
```

---

## Menu Management

### Get All Menu Items
**GET** `/menus`

**Query Parameters:**
- `page` (int, optional): Page number (default: 1)
- `pageSize` (int, optional): Items per page (max: 100, default: 20)
- `search` (string, optional): Search term for title or description
- `domainId` (int, optional): Filter by website/domain ID
- `parentId` (int, optional): Filter by parent menu ID
- `displayInNavigation` (bool, optional): Filter by navigation visibility

**Response:** Paginated list of menu items

### Get Menu Item by ID
**GET** `/menus/{id}`

**Path Parameters:**
- `id` (int, required): Menu item ID

**Response:** Single menu item object with edit model

### Create Menu Item
**POST** `/menus`

**Request Body:**
```json
{
  "domainID": 1,
  "title": "Menu Item Title",
  "icon": "home",
  "pageContent": "# Welcome\n\nThis is the page content in Markdown format.",
  "action": "Index",
  "controller": "Page",
  "description": "Menu item description",
  "displayInNavigation": true,
  "displayOrder": 10,
  "parentId": null,
  "url": "custom-url"
}
```

**Response:** Created menu item with HTTP 201

### Update Menu Item
**PUT** `/menus/{id}`

**Path Parameters:**
- `id` (int, required): Menu item ID

**Request Body:** (All fields optional)
```json
{
  "title": "Updated Title",
  "pageContent": "Updated content",
  "displayOrder": 15,
  "displayInNavigation": false
}
```

**Response:** Updated menu item object

### Delete Menu Item
**DELETE** `/menus/{id}`

**Path Parameters:**
- `id` (int, required): Menu item ID

**Response:**
```json
{
  "success": true,
  "data": { "deletedId": 1 },
  "message": "Menu item deleted successfully"
}
```

### Bulk Update Menu Order
**PUT** `/menus/bulk-update-order`

**Request Body:**
```json
{
  "menuOrders": [
    { "menuId": 1, "displayOrder": 1 },
    { "menuId": 2, "displayOrder": 2 },
    { "menuId": 3, "displayOrder": 3 }
  ]
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "updatedCount": 3,
    "errors": null
  },
  "message": "Updated 3 menu items successfully"
}
```

---

## Utility Endpoints

### Get Dashboard Statistics
**GET** `/dashboard/stats`

**Response:**
```json
{
  "success": true,
  "data": {
    "totalWebsites": 5,
    "totalMenuItems": 25,
    "recentWebsites": [/* 5 most recent websites */],
    "recentMenuItems": [/* 5 most recent menu items */],
    "websitesByTemplate": {
      "Modern": 3,
      "Classic": 2
    },
    "menuItemsByDomain": {
      "Main Site": 15,
      "Blog Site": 10
    }
  },
  "message": "Dashboard statistics retrieved successfully"
}
```

### Get Menu Hierarchy
**GET** `/websites/{websiteId}/menu-hierarchy`

**Path Parameters:**
- `websiteId` (int, required): Website ID

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "Home",
      "icon": "home",
      "url": "home",
      "displayOrder": 1,
      "displayInNavigation": true,
      "children": [
        {
          "id": 2,
          "title": "About",
          "icon": "info",
          "url": "home/about",
          "displayOrder": 1,
          "displayInNavigation": true,
          "children": []
        }
      ]
    }
  ],
  "message": "Menu hierarchy retrieved successfully"
}
```

### Global Search
**GET** `/search`

**Query Parameters:**
- `query` (string, required): Search term
- `page` (int, optional): Page number (default: 1)
- `pageSize` (int, optional): Items per page (max: 100, default: 20)

**Response:**
```json
{
  "success": true,
  "data": {
    "query": "blog",
    "items": [
      {
        "id": 1,
        "type": "Website",
        "title": "My Blog",
        "description": "Blog website",
        "url": "/WebCMS/Website/Details/1",
        "lastModified": "2023-12-01T10:30:00Z",
        "parentInfo": null
      },
      {
        "id": 5,
        "type": "Menu Item",
        "title": "Blog Posts",
        "description": "Latest blog posts",
        "url": "/WebCMS/Menu/Details/5",
        "lastModified": "2023-12-01T09:15:00Z",
        "parentInfo": "My Blog"
      }
    ],
    "totalCount": 2,
    "page": 1,
    "pageSize": 20,
    "totalPages": 1,
    "websiteCount": 1,
    "menuItemCount": 1
  },
  "message": "Found 2 results for 'blog'"
}
```

---

## Models

### Website Model
```json
{
  "id": 1,
  "name": "Website Name",
  "description": "Website description",
  "siteTemplate": "Modern",
  "siteStyle": "Light",
  "message": "Welcome message in Markdown",
  "siteName": "Display Name",
  "websiteUrl": "https://example.com",
  "websiteTitle": "Page Title",
  "useBreadCrumbURL": true,
  "isRecipeSite": false,
  "modifiedDT": "2023-12-01T10:30:00Z",
  "modifiedID": 99
}
```

### Menu Model
```json
{
  "id": 1,
  "domainID": 1,
  "domainName": "Website Name",
  "title": "Menu Title",
  "icon": "home",
  "pageContent": "Content in Markdown",
  "action": "Index",
  "controller": "Page",
  "argument": "page-slug",
  "url": "custom-url",
  "description": "Menu description",
  "displayInNavigation": true,
  "displayOrder": 10,
  "parentId": null,
  "parentTitle": null,
  "lastModified": "2023-12-01T10:30:00Z"
}
```

### Validation Rules

#### Website Validation:
- `name`: Required, max 255 characters
- `description`: Optional, max 1000 characters
- `websiteUrl`: Optional, must be valid URL, max 500 characters
- `siteTemplate`: Optional, max 100 characters
- `siteStyle`: Optional, max 100 characters

#### Menu Item Validation:
- `domainID`: Required, must be valid website ID
- `title`: Required, max 255 characters
- `description`: Optional, max 1000 characters
- `displayOrder`: Must be >= 0
- `url`: Optional, max 255 characters
- `icon`: Optional, max 50 characters (Bootstrap icon name)

---

## Examples

### Agent Workflow: Create a Complete Website

#### 1. Create Website
```bash
curl -X POST "https://webspark.markhazleton.com/api/WebCMS/WebCMSApi/websites" \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "My New Blog",
    "description": "A personal blog about technology",
    "siteTemplate": "Modern",
    "siteStyle": "Light",
    "websiteUrl": "https://myblog.example.com",
    "useBreadCrumbURL": true,
    "isRecipeSite": false
  }'
```

#### 2. Create Main Menu Items
```bash
# Create Home page
curl -X POST "https://webspark.markhazleton.com/api/WebCMS/WebCMSApi/menus" \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "domainID": 1,
    "title": "Home",
    "icon": "house",
    "pageContent": "# Welcome to My Blog\n\nThis is the homepage of my personal blog.",
    "displayOrder": 1,
    "displayInNavigation": true
  }'

# Create About page
curl -X POST "https://webspark.markhazleton.com/api/WebCMS/WebCMSApi/menus" \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "domainID": 1,
    "title": "About",
    "icon": "person",
    "pageContent": "# About Me\n\nI am a technology enthusiast who loves to write about the latest trends.",
    "displayOrder": 2,
    "displayInNavigation": true
  }'
```

#### 3. Query and Update
```bash
# Get website details
curl -X GET "https://webspark.markhazleton.com/api/WebCMS/WebCMSApi/websites/1" \
  -H "Authorization: Bearer {token}"

# Get menu hierarchy
curl -X GET "https://webspark.markhazleton.com/api/WebCMS/WebCMSApi/websites/1/menu-hierarchy" \
  -H "Authorization: Bearer {token}"

# Search for content
curl -X GET "https://webspark.markhazleton.com/api/WebCMS/WebCMSApi/search?query=blog" \
  -H "Authorization: Bearer {token}"
```

### Agent Workflow: Content Management

#### Bulk Update Menu Order
```bash
curl -X PUT "https://webspark.markhazleton.com/api/WebCMS/WebCMSApi/menus/bulk-update-order" \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "menuOrders": [
      { "menuId": 1, "displayOrder": 1 },
      { "menuId": 2, "displayOrder": 2 },
      { "menuId": 3, "displayOrder": 3 }
    ]
  }'
```

#### Update Website Settings
```bash
curl -X PUT "https://webspark.markhazleton.com/api/WebCMS/WebCMSApi/websites/1" \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "description": "Updated description with more details",
    "siteStyle": "Dark"
  }'
```

---

## HTTP Status Codes

- **200 OK**: Successful GET, PUT operations
- **201 Created**: Successful POST operations
- **400 Bad Request**: Invalid request data or validation errors
- **401 Unauthorized**: Missing or invalid authentication
- **403 Forbidden**: Insufficient permissions
- **404 Not Found**: Resource not found
- **500 Internal Server Error**: Server-side error

---

## Rate Limits

- **Standard Operations**: 100 requests per minute
- **Search Operations**: 50 requests per minute
- **Bulk Operations**: 10 requests per minute

---

## Best Practices for Agents

1. **Authentication**: Always include the Bearer token in requests
2. **Error Handling**: Check the `success` field in responses
3. **Pagination**: Use appropriate page sizes (10-50 items per page)
4. **Search**: Use specific search terms for better results
5. **Bulk Operations**: Prefer bulk updates for multiple items
6. **Validation**: Validate data before sending requests
7. **Rate Limiting**: Implement backoff strategies for rate limit errors
8. **Logging**: Log all API interactions for debugging
9. **Caching**: Cache static data like website lists where appropriate
10. **URL Generation**: Use the auto-generated URLs or provide custom ones

---

## Version History

- **v1.0**: Initial release with full CRUD operations
- **Future**: Planned features include file upload, advanced search, and webhook support